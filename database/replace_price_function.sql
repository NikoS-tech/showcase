CREATE
    FUNCTION `REPLACE_PRICE_FUNCTION`(X TEXT CHARSET utf8)
    RETURNS TEXT CHARSET utf8
BEGIN
    DECLARE _PRICE, _SYMBOL, _TMP TEXT CHARSET utf8mb4;
    DECLARE _DOT_COUNTER, _LOCATE INT DEFAULT 0;
    DECLARE _I INT DEFAULT 1;

    SET _PRICE = REPLACE(REPLACE(REPLACE(CONVERT(X USING ASCII), '?', ''), ',', '.'), ' ', '');
    SET _SYMBOL = SUBSTRING(_PRICE, _I, 1);

    IF LOWER(X) = 'null' THEN
        RETURN NULL;
    END IF;

    beginning:
    WHILE (_I <= LENGTH(_PRICE)) DO
        SET _SYMBOL = SUBSTRING(_PRICE, _I, 1);
        IF(_SYMBOL REGEXP ('^[0-9]+$')) THEN
            LEAVE beginning;
        END IF;
        SET _I = _I + 1;
    END WHILE;

    SET _PRICE = SUBSTRING(_PRICE FROM _I);
    SET _I = 1;

    ending:
    WHILE (_I <= LENGTH(_PRICE)) DO
            SET _SYMBOL = SUBSTRING(_PRICE, _I, 1);
            IF(_SYMBOL NOT REGEXP ('^[0-9.]+$')) THEN
                LEAVE ending;
            END IF;
            SET _I = _I + 1;
        END WHILE;

    SET _PRICE = TRIM(BOTH '.' FROM SUBSTRING(_PRICE, 1, _I - 1));
    SET _DOT_COUNTER = LENGTH(_PRICE) - LENGTH(REPLACE(_PRICE, '.', ''));

    IF (_DOT_COUNTER = 0) THEN
        RETURN IF(_PRICE <> '', (_PRICE) + 0, NULL);
    END IF;

    IF (_DOT_COUNTER > 2) THEN
        SET _PRICE = SUBSTRING_INDEX(_PRICE, '.', 3);
    END IF;

    SET _LOCATE = LOCATE('.', _PRICE);
    SET _TMP = SUBSTRING(_PRICE, _LOCATE + 1, LENGTH(_PRICE));

    SET _TMP = REVERSE(_TMP);
    SET _TMP = SUBSTRING(_TMP, LOCATE('.', _TMP) + 1, LENGTH(_TMP));

    IF LENGTH(_TMP) = 3 THEN
        SET _PRICE = INSERT(_PRICE, _LOCATE, 1, '');
    END IF;

    SET _TMP = 0;
    IF (INSTR(_PRICE, '.')) THEN
        SET _TMP = SUBSTRING_INDEX(SUBSTRING_INDEX(_PRICE, '.', 2), '.', -1);
        IF LENGTH(_TMP) > 2 THEN
            SET _TMP = ROUND(INSERT(_TMP, 3, 0, '.'));
            IF (_TMP < 10) THEN
                SET _TMP = CONCAT('0', _TMP);
            END IF;
        END IF;

        SET _PRICE = SUBSTRING_INDEX(_PRICE, '.', 1);
        SET _PRICE = IF(_TMP >= 100, _PRICE + (_TMP / 100), CONCAT(_PRICE, '.', _TMP));
    END IF;

    RETURN (_PRICE) + 0;
END;

-- TEST CASES --

SELECT REPLACE_PRICE_FUNCTION('120');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120.15');
/** 120.15 **/

SELECT REPLACE_PRICE_FUNCTION('120,15');
/** 120.15 **/

SELECT REPLACE_PRICE_FUNCTION('120.125');
/** 120125 **/

SELECT REPLACE_PRICE_FUNCTION('120,125');
/** 120125 **/

SELECT REPLACE_PRICE_FUNCTION('3 123');
/** 3123 **/

SELECT REPLACE_PRICE_FUNCTION('31 23');
/** 3123 **/

SELECT REPLACE_PRICE_FUNCTION('312 3');
/** 3123 **/

SELECT REPLACE_PRICE_FUNCTION('120.00 DV');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120,00 DV');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120.00.05 DV');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120.00,01 DV');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120,00.01 DV');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120,00,01 DV');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120.00 DV.');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120,00 DV.');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120.00.05 DV.');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120.00,01 DV.');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120,00.01 DV.');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('120,00,01 DV.');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV 120.00');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV 120,00');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV 120.00.05');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV 120.00,01');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV 120,00.01');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV 120,00,01');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. 120.00');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. 120,00');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. 120.00.05');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. 120.00,01');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. 120,00.01');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV .120,00,01');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. DVV. 120.00');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. DVV. 120,00');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. DVV. 120.00.05');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. DVV. 120.00,01');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. DVV. 120,00.01');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. DVV. .120,00,01');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV 120');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. 120');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV DVV. 120');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV. DVV 120');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV DVV 120');
/** 120 **/

SELECT REPLACE_PRICE_FUNCTION('DV 120.005');
/** 120005 **/

SELECT REPLACE_PRICE_FUNCTION('DV. 120.005');
/** 120005 **/

SELECT REPLACE_PRICE_FUNCTION('DV DVV. 120.005');
/** 120005 **/

SELECT REPLACE_PRICE_FUNCTION('DV. DVV 120.005');
/** 120005 **/

SELECT REPLACE_PRICE_FUNCTION('DV DVV 120.005');
/** 120005 **/

SELECT REPLACE_PRICE_FUNCTION('31 2.3 kr');
/** 312.3 **/

SELECT REPLACE_PRICE_FUNCTION('31 2,3 kr');
/** 312.3 **/

SELECT REPLACE_PRICE_FUNCTION('239.00 kr. før 299,00 kr');
/** 239 **/

SELECT REPLACE_PRICE_FUNCTION('239,00 kr. før 299,00 kr');
/** 239 **/

SELECT REPLACE_PRICE_FUNCTION('239,000.1 kr. før 299,00 kr');
/** 239000.1 **/

SELECT REPLACE_PRICE_FUNCTION('239.100.1 kr. før 299,00 kr');
/** 239100.1 **/

SELECT REPLACE_PRICE_FUNCTION('239,100,1 kr. før 299,00 kr');
/** 239100.1 **/

SELECT REPLACE_PRICE_FUNCTION('32.3 kr');
/** 32.3 **/

SELECT REPLACE_PRICE_FUNCTION('null');
/** NULL **/

SELECT REPLACE_PRICE_FUNCTION('string');
/** NULL **/

SELECT REPLACE_PRICE_FUNCTION('0');
/** 0 **/

SELECT REPLACE_PRICE_FUNCTION('0.989899');
/** 0.99 **/

SELECT REPLACE_PRICE_FUNCTION('239,100,115 kr. før 299,00 kr');
/** 239100.12 **/

SELECT REPLACE_PRICE_FUNCTION('239,100,114 kr. før 299,00 kr');
/** 239100.11 **/

SELECT REPLACE_PRICE_FUNCTION('19.95000000000002,');
/** 19.95 **/

SELECT REPLACE_PRICE_FUNCTION('103.9967');
/** 104 **/

SELECT REPLACE_PRICE_FUNCTION('103.9867');
/** 103.99 **/

SELECT REPLACE_PRICE_FUNCTION('104.09967');
/** 104.1 **/

SELECT REPLACE_PRICE_FUNCTION('2.029601');
/** 2.03 **/
